<?php
if(!isset($_SESSION)) {
    session_start();
}
/*******************************************************************************************************************/

use App\Models\User;
use App\Models\Visita;
use Illuminate\Support\Facades\Auth;    
/*******************************************************************************************************************/
if (Auth::check())
{ 
    if(isset($_SESSION['login'])){
/*        
        echo "sesion Abierta a usuario :"."<br>";
        echo "id_Usuario :"   .$_SESSION['login']['u_id'];   echo"<br>";
        echo "Nom_Usu :"      .$_SESSION['login']['u_nom'];  echo"<br>";
*/
    }else
    {
        echo "sesion No Abierta";
    }
}else{
session_destroy();
echo "Sesion cerrada";
}
/*******************************************************************************************************************/
?>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <link rel="stylesheet" href="{{asset('css/app.css')}}">

</head>
<body>
<!-- ******************************************************************************************************************* -->


<x-app-layout>


<!-- BANNER -->
<!-- ....tailwind.config.js ............................................................................................ -->
<!-- ................................................................................................................... -->

    <div class="flex justify-center bg-blue-900 mb-4">
        @if (Auth::check())
        <p class="text-white  font-bold ml-10">SESION COMO : <?php echo " ".$_SESSION['login']['u_rol'];?> - <?php echo $_SESSION['login']['u_nom'];?> </p>
        @else
        <p class="text-blue-900">.</p>
        @endif                     
    </div>

<!-- ACCESO A MENUS -->
<!-- ................................................................................................................... -->

    <div class="flex justify-center ">
        <div><a class="border border-black px-2 py-2 mb-60 mr-4" href="{{route('users.listado')}}">PACIENTES</a></div>
        <div><a class="border border-black px-2 py-2 mb-60 mr-4" href="{{route('tratamientos.listado')}}">TRATAMIENTOS</a></div>
        <div><a class="border border-black px-2 py-2 mb-60 mr-4" href="{{route('productos.listado')}}">PRODUCTOS</a></div>
        <div><a class="border border-black px-2 py-2 mb-60 mr-4" href="{{route('origenes.listado')}}">ORIGENES</a></div>
        <div><a class="border border-black px-2 py-2 mb-60 mr-4" href="{{route('visitas.listado')}}">VISITAS</a></div>
    </div>
    <br>
    <hr class="bg-red-900 h-1 mx-4">
        <div class="text-center">FACTURA</div>
    <hr class="bg-red-900 h-1 mx-4">





<!-- FACTURAS -->    
<!-- ................................................................................................................... -->
<div class="container mx-auto">
<div class="grid grid-cols-6">  
   
    <!-- ..................................................................................................................................... -->                    
    <div class=" border-0 border-slate-200"></div>
    <!-- ..................................................................................................................................... -->
    <div class=" border-0 border-slate-200
                 col-span-2">
        <div class="text-4xl font-bold ">[MedChi]</div><br>
        [Direcció]<br>
        [Ciudad] - [Código Postal]<br>
        Tel.[Teléfono]<br> 
        Email [email]
    </div>
    <!-- ..................................................................................................................................... -->
    <div class=" border-0 border-slate-200"></div>
    <!-- ..................................................................................................................................... -->
    <div class=" border-0 border-slate-200">
        <div class="text-4xl font-bold text-center">FACTURA</div>
        <img class="hidden lg:block h-15 w-auto mt-5 ml-16" src="{{asset('img/csglogorec03.png')}}" title="CSG">
    </div>
    <!-- ..................................................................................................................................... -->
    <div class=" border-0 border-slate-200"></div>
    <!-- ************************************************************************************************************************************* -->


    <!-- ..................................................................................................................................... -->                    
    <div class=" border-0 border-slate-200"></div>
    <!-- ..................................................................................................................................... -->
    <div class=" border-0 border-slate-200"></div>
    <!-- ..................................................................................................................................... -->
    <div class=" border-0 border-slate-200"></div>
    <!-- ..................................................................................................................................... -->
    <div class=" border-0 border-slate-200
                 bg-gray-400
                 text-center">
                 <div class="text-lg">FACTURA Nº</div>
    </div>
    <!-- ..................................................................................................................................... -->
    <div class=" border-0 border-slate-200
                 bg-gray-400
                 text-center">
                 <div class="text-lg">FECHA</div>
    </div>
    <!-- ..................................................................................................................................... -->
    <div class=" border-0 border-slate-200"></div>
    <!-- ************************************************************************************************************************************* -->

    <!-- Nº Factura y Fecha -->
    <!-- ..................................................................................................................................... -->
    <div class=" border-0 border-slate-200"></div>
    <!-- ..................................................................................................................................... -->
    <div class=" border-0 border-slate-200"></div>
    <!-- ..................................................................................................................................... -->
    <div class=" border-0 border-slate-200"></div>
    <!-- ..................................................................................................................................... -->
    <div class=" border-0 border-slate-200">
            <div class="text-center"> 
                <?php //$dia= date("d"); ?>
                <?php //$mes= date("m"); ?>
                <?php //$ano= date("y"); ?>
                <?php //echo $con= "F".$dia.$mes.$ano.$visita->id; ?>
                <?php 
                        $vis= Visita::all()->last();
                        $ultimo= $vis->id;
                        if(strlen($ultimo) == 1){ echo "F"."0000".$ultimo;};
                ?>
        
        
            </div>
    </div>
    <!-- ..................................................................................................................................... -->
    <div class=" border-0 border-slate-200">
        <div class="text-center"> <?php echo date("d-m-Y"); ?></div>
    </div>
    <!-- ..................................................................................................................................... -->
    <div class=" border-0 border-slate-200"></div>
    <!-- ************************************************************************************************************************************* -->

    <!-- ..................................................................................................................................... -->                    
    <div class=" border-0 border-slate-200"></div>
    <!-- ..................................................................................................................................... -->
    <div class=" border-0 border-slate-200"></div>
    <!-- ..................................................................................................................................... -->
    <div class=" border-0 border-slate-200"></div>
    <!-- ..................................................................................................................................... -->
    <div class=" border-0 border-slate-200"></div>
    <!-- ..................................................................................................................................... -->
    <div class=" border-0 border-slate-200"></div>
    <!-- ..................................................................................................................................... -->
    <div class=" border-0 border-slate-200">&nbsp</div>
    <!-- ************************************************************************************************************************************* -->



    <!-- ..................................................................................................................................... -->
    <div class=" border-0 border-slate-200"></div>
    <!-- ..................................................................................................................................... -->
    <div class=" border-0 border-slate-200
                 bg-gray-400 text-center">
                 <div class="">FACTURAR A</div>
    </div>
    <!-- ..................................................................................................................................... -->
    <div class=" border-0 border-slate-200"></div>
    <!-- ..................................................................................................................................... -->
    <div class=" border-0 border-slate-200
                 bg-gray-400 text-center">
                 <div class="">CLIENTE Nº</div>
    </div>
    <!-- ..................................................................................................................................... -->
    <div class=" border-0 border-slate-200
                 bg-gray-400 text-center">
                 <div class="">Nª VISITA</div>
    </div>
    <!-- ..................................................................................................................................... -->
    <div class=" border-0 border-slate-200"></div>
    <!-- ************************************************************************************************************************************* -->




    <!-- ..................................................................................................................................... -->                    
    <div class=" border-0 border-slate-200"></div>
    <!-- ..................................................................................................................................... -->
    <div class=" border-0 border-slate-200">

        <?php $NumCli= $visita->user_id; ?>
        <?php $usu= User::find($NumCli); ?>
        {{$usu->name}}<br>
        {{$usu->apellido}}<br>
        {{$usu->tfno}}<br>
        {{$usu->email}}<br>
        {{$usu->origen_id}}<br>

    </div>
    <!-- ..................................................................................................................................... -->
    <div class=" border-0 border-slate-200"></div>
    <!-- ..................................................................................................................................... -->
    <div class=" border-0 border-slate-200">
        <div class="text-center">{{$visita->user_id}}</div>
    </div>
    <!-- ..................................................................................................................................... -->
    <div class=" border-0 border-slate-200">
        <div class="text-center">{{$visita->id}}</div>
    </div>
    <!-- ..................................................................................................................................... -->
    <div class=" border-0 border-slate-200"></div>
    <!-- ************************************************************************************************************************************* -->


    <!-- ..................................................................................................................................... -->                    
    <div class=" border-0 border-slate-200"></div>
    <!-- ..................................................................................................................................... -->
    <div class=" border-0 border-slate-200"></div>
    <!-- ..................................................................................................................................... -->
    <div class=" border-0 border-slate-200"></div>
    <!-- ..................................................................................................................................... -->
    <div class=" border-0 border-slate-200"></div>
    <!-- ..................................................................................................................................... -->
    <div class=" border-0 border-slate-200"></div>
    <!-- ..................................................................................................................................... -->
    <div class=" border-0 border-slate-200"></div>
    <!-- ************************************************************************************************************************************* -->


    <!-- ..................................................................................................................................... -->                    
    <div class=" border-0 border-slate-200"></div>
    <!-- ..................................................................................................................................... -->
    <div class=" border-0 border-slate-200
                 bg-gray-400">
                 <div class="">DESCRIPCIÓN</div>
    </div>
    <!-- ..................................................................................................................................... -->
    <div class=" border-0 border-slate-200
                 bg-gray-400
                 text-center">
                 <div class="">CANT</div>
    </div>
    <!-- ..................................................................................................................................... -->
    <div class=" border-0 border-slate-200
                 bg-gray-400
                 text-center">
                 <div class="">PRECIO</div>
    </div>
    <!-- ..................................................................................................................................... -->
    <div class=" border-0 border-slate-200
                 bg-gray-400
                 text-center">
                 <div class="">TOTAL</div>
    </div>
    <!-- ..................................................................................................................................... -->
    <div class=" border-0 border-slate-200"></div>
    <!-- ************************************************************************************************************************************* -->


    <!-- ..................................................................................................................................... -->                    
    <div class=" border-2 border-slate-200"></div>
    <!-- ..................................................................................................................................... -->
    <div class=" border-2 border-slate-200">
        <div class="bg-gray-400 text-white text-right">Tratamientos</div>
        @foreach($visita->tratamientos as $tratamiento)
            {{$tratamiento->id}}-{{$tratamiento->tratamiento}}<br>
        @endforeach

        <div class="bg-gray-400 text-white text-right">Productos</div>
        @foreach($visita->productos as $producto)
            {{$producto->id}}-{{$producto->nombre}}<br>
        @endforeach


    </div>
    <!-- ..................................................................................................................................... -->
    <div class=" border-2 border-slate-200 text-center">
        <div class="">&nbsp</div>
        @for($i=0; $i< count($visita->tratamientos); $i++)
                {{1}}<br>
        @endfor

        <div class="">&nbsp</div>
        @for($i=0; $i< count($visita->productos); $i++)
                {{1}}<br>
        @endfor
    
    </div>
    <!-- ..................................................................................................................................... -->
    <div class=" border-2 border-slate-200 text-center">
        <div class="">&nbsp</div>
        @foreach($visita->tratamientos as $tratamiento)
            {{$tratamiento->pretrat}}<br>
        @endforeach

        <div class="">&nbsp</div>
        @foreach($visita->productos as $producto)
            {{$producto->preprod}}<br>
        @endforeach

    </div>
    <!-- ..................................................................................................................................... -->
    <div class=" border-2 border-slate-200 text-center">
        <div class="">&nbsp</div>
        @foreach($visita->tratamientos as $tratamiento)
            {{$tratamiento->pretrat}}<br>
        @endforeach

        <div class="">&nbsp</div>
        @foreach($visita->productos as $producto)
            {{$producto->preprod}}<br>
        @endforeach

    </div>
    <!-- ..................................................................................................................................... -->
    <div class=" border-2 border-slate-200">&nbsp</div>
    <!-- ************************************************************************************************************************************* -->


    <!-- ..................................................................................................................................... -->                    
    <div class=" border-0 border-slate-200"></div>
    <!-- ..................................................................................................................................... -->
    <div class=" border-0 border-slate-200"></div>
    <!-- ..................................................................................................................................... -->
    <div class=" border-0 border-slate-200"></div>
    <!-- ..................................................................................................................................... -->
    <div class=" border-0 border-slate-200
                 bg-gray-400
                 text-left
                 mt-20">
                 <div class="">SUBTOTAL</div>
                 <div class="">IVA</div>
                 <div class="">TOTAL</div>
    </div>

    <!-- ..................................................................................................................................... -->
    <div class=" border-0 border-slate-200"></div>
    <!-- ..................................................................................................................................... -->
    <div class=" border-0 border-slate-200"></div>
    <!-- ************************************************************************************************************************************* -->

        <br><br><br><br><br><br>



        














</div>
</div>
<!-- ................................................................................................................... -->
</x-app-layout>
</body>
</html>